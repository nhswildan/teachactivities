<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Journal Activities</title>
<link rel="icon" type="image/png" href="./Favicon NHS.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap');

:root{
  --accent:#1548bf;
  --accent-strong:#123fa6;
  --danger:#e11d48;
  --bg:#f7f8fb;
  --card:#ffffff;
  --muted:#6b7280;
  --text:#0f172a;
  --radius:12px;
  --maxwidth:1280px;
}

*{box-sizing:border-box;font-family:'Noto Sans',sans-serif;}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);}
header.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 34px;
  background:var(--card);
  box-shadow:0 3px 12px rgba(0,0,0,0.06);
  position:fixed;
  top:0;
  left:0;
  width:100%;
  z-index:10;
}
.logo img{height:30px;width:auto;border-radius:6px}
.title{flex:1;text-align:center}
.title h1{margin:0;font-size:20px;font-weight:700;color:#000}
.title p{margin:6px 0 0 0;color:var(--muted);font-size:13px}
.profile{display:flex;align-items:center;gap:10px}
.profile svg{stroke:#9ca3af}
.profile .name{font-size:14px;color:#374151}

.container{
  max-width:var(--maxwidth);
  margin:0 auto;
  padding:120px 20px 60px 20px;
}

.form-section{background:var(--card);padding:22px;border-radius:var(--radius);box-shadow:0 4px 18px rgba(15,23,42,0.03);margin-bottom:20px}
.form-row{display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input[type=text],input[type=number],input[type=date],select,textarea{
  width:100%;padding:10px;border-radius:calc(var(--radius) - 2px);border:1px solid #e6e9ef;font-size:14px;background:#fff;transition:box-shadow .18s, border-color .18s;
}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 6px 18px rgba(21,72,191,0.08);}
select{cursor:pointer}

.btn{background:var(--accent);color:#fff;border:0;padding:9px 14px;border-radius:10px;font-weight:600;cursor:pointer;transition:all .2s}
.btn:hover{background:var(--accent-strong);transform:translateY(-1px)}
.btn.gray{background:#eef2f7;color:#374151}
.btn.red{background:var(--danger);color:#fff}

.chip{display:inline-flex;align-items:center;background:rgba(21,72,191,0.08);color:var(--accent);padding:6px 10px;border-radius:20px;margin:4px 6px;font-weight:600;font-size:13px}
.chip .x{margin-left:8px;cursor:pointer;color:#9b0b2a;font-weight:700}

.att-row{display:flex;gap:10px;align-items:center;margin-bottom:8px}
.att-row input{flex:1}
.att-row select{width:170px}
.att-row .del-x{background:transparent;border:0;color:var(--danger);font-weight:700;cursor:pointer;font-size:16px}

.cards-wrap{margin:14px 0 6px 0;display:flex;flex-wrap:wrap;gap:10px}
.card{background:var(--card);padding:10px 12px;border-radius:14px;box-shadow:0 6px 18px rgba(15,23,42,0.03);cursor:pointer;transition:all .12s}
.card:hover{transform:translateY(-4px);box-shadow:0 12px 28px rgba(21,72,191,0.06);}
.card.active{background:var(--accent);color:#fff;}
.card.active .small{color:#e0e7ff !important}

.table-wrap{margin-top:16px}
table{width:100%;border-collapse:collapse;background:var(--card);border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(15,23,42,0.04)}
thead th{background:#fafcff;padding:12px;text-align:left;font-weight:700}
tbody td{padding:12px;border-top:1px solid #f3f5f8;text-align:left;vertical-align:top;font-size:14px}
tbody tr:hover{background:linear-gradient(90deg,rgba(21,72,191,0.03),transparent)}

@media (max-width:768px){
  .form-row{flex-direction:column;}
  .cards-wrap{flex-direction:column;}
  .table-wrap table, .table-wrap thead, .table-wrap tbody, .table-wrap th, .table-wrap td, .table-wrap tr{
    display:block;
  }
  .table-wrap thead{display:none;}
  .table-wrap td{
    padding:8px;
    border:none;
    border-bottom:1px solid #ddd;
    position:relative;
    padding-left:50%;
    text-align:left;
  }
  .table-wrap td:before{
    position:absolute;
    top:8px;
    left:8px;
    width:45%;
    white-space:nowrap;
    font-weight:600;
  }
  .table-wrap td:nth-of-type(1):before{content:"Tanggal";}
  .table-wrap td:nth-of-type(2):before{content:"Pertemuan";}
  .table-wrap td:nth-of-type(3):before{content:"Topik";}
  .table-wrap td:nth-of-type(4):before{content:"Aktivitas";}
  .table-wrap td:nth-of-type(5):before{content:"Kehadiran";}
  .table-wrap td:nth-of-type(6):before{content:"Catatan";}
  .table-wrap td:nth-of-type(7):before{content:"Aksi";}
}
</style>
</head>
<body>

<header class="header">
  <div class="logo"><img src="./Logo NHS NA.png" alt="logo"></div>
  <div class="title">
    <h1>Journal Activities</h1>
    <p>Academic Year 2025/2026</p>
  </div>
  <div class="profile">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="4" stroke="#9ca3af" stroke-width="1.6"/><path d="M4 20c0-3.314 2.686-6 6-6h4c3.314 0 6 2.686 6 6" stroke="#9ca3af" stroke-width="1.6"/></svg>
    <div class="name">Wildan Fido Ramadhan</div>
  </div>
</header>

<main class="container">
  <section class="form-section">
    <div class="form-row">
      <div style="flex:1">
        <label for="kelas">Kelas</label>
        <select id="kelas">
          <option value="">Pilih Kelas</option>
          <option>G12 Antropologi</option>
          <option>G11 - 1 Antropologi</option>
          <option>G11 - 2 Antropologi</option>
          <option>G10 A Geografi</option>
          <option>G10 B Geografi</option>
          <option>G10 Inter A Geografi</option>
          <option>G10 Inter B Geografi</option>
          <option>G10 Inter A Sosiologi</option>
          <option>G10 Inter B Sosiologi</option>
        </select>
      </div>
      <div style="flex:1">
        <label for="tanggal">Tanggal</label>
        <input id="tanggal" type="date">
      </div>
    </div>

    <div class="form-row">
      <div style="flex:1">
        <label for="pertemuan">Pertemuan</label>
        <input id="pertemuan" type="number" min="1" placeholder="Ke-">
      </div>
      <div style="flex:2">
        <label for="topik">Topik</label>
        <input id="topik" type="text" placeholder="Topik pembelajaran">
      </div>
    </div>

    <div class="form-row">
      <div style="flex:1">
        <label for="aktivitasSelect">Aktivitas</label>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="aktivitasSelect">
            <option value="">Pilih aktivitas</option>
            <option>Materi</option><option>Presentasi</option><option>Diskusi Kelompok</option>
            <option>Kuis</option><option>Worksheet</option><option>Ulangan Harian</option>
            <option>Kolaborasi</option><option>Pekan Penilaian</option><option>UAS</option><option>Kunjungan</option><option>Lainnya</option>
          </select>
          <button id="addAktivitasBtn" class="btn" type="button">Tambah</button>
        </div>
        <div id="aktivitasList" style="margin-top:8px"></div>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Kehadiran</label>
      <div id="attendanceContainer"></div>
      <div style="margin-top:8px">
        <button id="addAttBtn" type="button" class="btn gray">+ Tambah Kehadiran</button>
      </div>
    </div>

    <div style="margin-top:12px">
      <label for="catatan">Catatan</label>
      <input id="catatan" type="text" placeholder="Catatan sesi (opsional)">
    </div>

    <div style="margin-top:14px;text-align:right">
      <button id="saveBtn" class="btn">Simpan</button>
    </div>
  </section>

  <section>
    <div class="cards-wrap" id="cardsWrap"></div>
  </section>

  <section class="table-wrap" id="tableWrap"></section>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuS1YmoA9kcXbqm34jMUDgk73njqIKc4s",
  authDomain: "journal-nhs.firebaseapp.com",
  projectId: "journal-nhs",
  storageBucket: "journal-nhs.firebasestorage.app",
  messagingSenderId: "162381796113",
  appId: "1:162381796113:web:4c65bd5c934ce9af55f2b0",
  measurementId: "G-8M7RF0P9NG",
  databaseURL: "https://journal-nhs-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const CLASSES = [
  "G12 Antropologi","G11 - 1 Antropologi","G11 - 2 Antropologi",
  "G10 A Geografi","G10 B Geografi","G10 Inter A Geografi",
  "G10 Inter B Geografi","G10 Inter A Sosiologi","G10 Inter B Sosiologi"
];

const el = id => document.getElementById(id);
let currentClass = null;
let entries = {};

function escapeHtml(s){return s?s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])):'';}
function formatDate(dateStr){if(!dateStr)return'';const [y,m,d]=dateStr.split('-');return`${d}/${m}/${y}`;}

function renderCards(){
  const wrap = el('cardsWrap');
  wrap.innerHTML = '';
  CLASSES.forEach(c=>{
    const card = document.createElement('div');
    card.className='card';
    const count = entries[c]?Object.keys(entries[c]).length:0;
    card.innerHTML=`<div style="font-weight:700">${escapeHtml(c)}</div><div class="small" style="margin-top:6px;color:var(--muted)">${count} sesi</div>`;
    card.onclick=()=>{
      document.querySelectorAll('.card').forEach(x=>x.classList.remove('active'));
      card.classList.add('active');
      currentClass=c;
      renderTable(c);
    };
    wrap.appendChild(card);
  });
}

function renderTable(c){
  const wrap = el('tableWrap'); 
  wrap.innerHTML='';

  const rowsObj = entries[c] || {};
  const keys = Object.keys(rowsObj);

  let html = `
    <div style="display:flex;flex-wrap:wrap;justify-content:flex-end;gap:10px;margin-bottom:10px">
      <button class="btn gray" onclick="renderTable('${c}')">Refresh</button>
      <button class="btn" onclick="exportPDF('${c}')">Export PDF</button>
    </div>
    <div style="overflow-x:auto">
    <table>
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Pertemuan</th>
          <th>Topik</th>
          <th>Aktivitas</th>
          <th>Kehadiran</th>
          <th>Catatan</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
  `;

  if(keys.length===0){
    html += '<tr><td colspan="7" style="padding:20px;color:var(--muted)">Belum ada data.</td></tr>';
  } else {
    keys.forEach(k=>{
      const r = rowsObj[k];
      html += `
        <tr>
          <td>${formatDate(r.tanggal)}</td>
          <td>${r.pertemuan}</td>
          <td>${escapeHtml(r.topik)}</td>
          <td>${r.aktivitas.map(escapeHtml).join(', ')}</td>
          <td>${r.kehadiran.map(escapeHtml).join('<br>')}</td>
          <td>${escapeHtml(r.catatan)}</td>
          <td><button class="btn red" onclick="deleteEntry('${c}','${k}')">Hapus</button></td>
        </tr>
      `;
    });
  }

  html += `</tbody></table></div>`;
  wrap.innerHTML = html;
}

window.exportPDF = (kelas) => {
  const tableContent = document.getElementById('tableWrap').innerHTML;
  const printWindow = window.open('', '', 'width=900,height=700');
  printWindow.document.write(`
    <html><head><title>Journal - ${kelas}</title>
    <style>
      body { font-family: 'Noto Sans', sans-serif; margin: 20px; background:#f7f8fb; color:#0f172a; }
      h2 { text-align:center; margin-bottom:20px; }
      table { width: 100%; border-collapse: collapse; background:#fff; border-radius:10px; overflow:hidden; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align:left; vertical-align:top; }
      th { background: #f0f4ff; }
      tr:hover { background: #e0e7ff; }
      @media print {
        body { margin:0; }
        table { page-break-inside: auto; }
        tr { page-break-inside: avoid; page-break-after: auto; }
      }
    </style>
    </head><body>
      <h2>Journal Activities - ${kelas}</h2>
      ${tableContent}
    </body></html>
  `);
  printWindow.document.close();
  printWindow.print();
};

window.deleteEntry = (c, key)=>{
  remove(ref(db, `entries/${c}/${key}`));
};

function addAktivitas(){
  const val=el('aktivitasSelect').value; if(!val)return;
  const list=el('aktivitasList');
  const chip=document.createElement('div'); chip.className='chip';
  chip.textContent = val;
  const x = document.createElement('span'); x.className='x'; x.textContent='×'; x.onclick=()=>chip.remove();
  chip.appendChild(x);
  list.appendChild(chip);
  el('aktivitasSelect').value='';
}

function addKehadiran(){
  const cont=el('attendanceContainer');
  const row=document.createElement('div'); row.className='att-row';
  row.innerHTML=`<input type="text" placeholder="Nama siswa"><select><option>Hadir</option><option>Izin</option><option>Sakit</option><option>Alpa</option></select><button class="del-x" onclick="this.parentElement.remove()">×</button>`;
  cont.appendChild(row);
}

function performSave(){
  const k=el('kelas').value.trim(); 
  if(!k) return alert('Pilih kelas dulu!');
  if(!CLASSES.includes(k)) return alert('Kelas tidak valid!');
  
  const data={
    tanggal:el('tanggal').value,
    pertemuan:el('pertemuan').value,
    topik:el('topik').value,
    aktivitas:[...el('aktivitasList').querySelectorAll('.chip')].map(c=>c.textContent.replace('×','').trim()),
    kehadiran:[...el('attendanceContainer').querySelectorAll('.att-row')].map(r=>{
      const nama=r.querySelector('input').value.trim(); 
      const st=r.querySelector('select').value;
      return nama ? `${nama} (${st.charAt(0)})` : null;
    }).filter(Boolean),
    catatan:el('catatan').value
  };
  
  if(!data.tanggal||!data.pertemuan||!data.topik) return alert('Lengkapi data dulu!');
  
  push(ref(db, `entries/${k}`), data);
  
  // reset form
  el('aktivitasList').innerHTML=''; 
  el('attendanceContainer').innerHTML='';
  el('topik').value=''; 
  el('pertemuan').value=''; 
  el('catatan').value=''; 
  el('tanggal').value='';
}

function subscribe(){
  onValue(ref(db, 'entries'), snapshot=>{
    entries = snapshot.val() || {};
    renderCards();
    if(currentClass) renderTable(currentClass);
  });
}

el('addAktivitasBtn').onclick=addAktivitas;
el('addAttBtn').onclick=addKehadiran;
el('saveBtn').onclick=performSave;

subscribe();
</script>

</body>
</html>
